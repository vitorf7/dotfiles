#!/usr/bin/env fish

gum style \
    --foreground 12 --border-foreground 12 --border double \
    --align center --width 60 --margin "1 0" --padding "1 0" \
    'â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•'

set -l NOW (date +"%Y-%m-%d-%H-%M-%S")
echo -e "$NOW\n" >>/tmp/u-$NOW.txt

gum spin --spinner globe --title "ðŸ™ gh extensions upgrading..." --show-output -- gh extension upgrade --all >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ™ gh extensions upgraded"

gum spin --spinner globe --title "ðŸªŸ tpm plugins updating..." --show-output -- ~/.config/tmux/plugins/tpm/bin/update_plugins all >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸªŸ tpm plugins updated"

gum spin --spinner globe --title "ðŸ  fisher plugins updating..." --show-output -- fisher update >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ  fisher plugins updated"

gum spin --spinner globe --title "ðŸ» brew updating" --show-output -- brew update >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ» brew updated"

set -l OUTDATED (brew outdated)
echo $OUTDATED >>/tmp/u-$NOW.txt

if test -n "$OUTDATED"
    gum spin --spinner globe --title "ðŸ» brew upgrading" --show-output -- brew-up-to-date >>/tmp/u-$NOW.txt
    echo "\n" >>/tmp/u-$NOW.txt
    echo "âœ… ðŸ» brew upgraded"

    gum spin --spinner globe --title "ðŸ» brew cleaning up" --show-output -- brew cleanup --prune=all >>/tmp/u-$NOW.txt
    echo "\n" >>/tmp/u-$NOW.txt
    echo "âœ… ðŸ» brew cleaned up"
else
    echo "No outdated brew packages" >>/tmp/u-$NOW.txt
end

gum spin --spinner globe --title "ðŸ» brew upgrading casks" --show-output -- brew-force-update-casks >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ» brew upgraded casks"

gum spin --spinner globe --title "ðŸ» brew doctoring" --show-output -- brew doctor >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ» brew doctored"

gum spin --spinner globe --title "ðŸ¦€ cargo updating" --show-output -- cargo install-update -a >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ¦€ cargo updated"

gum spin --spinner globe --title "ðŸŒŸ nerd fonts updating" --show-output -- getnf -U >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸŒŸ nerd fonts updated"

gum spin --spinner globe --title "ðŸšª closing all neovim instances" --show-output -- close_neovim_in_tmux >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸšª closed all neovim instances"

gum spin --spinner globe --title "îš® updating neovim nightly" --show-output -- bob update nightly >>/tmp/u-$NOW.txt
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… îš® updated neovim nightly"

gum spin --spinner globe --title "ðŸ’¤ lazy.nvim syncing..." -- nvim --headless "+Lazy! sync" +qa
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ’¤ lazy.nvim synced"

gum spin --spinner globe --title "ðŸ§° mason.nvim updating" -- nvim --headless "+MasonUpdate" +qa
echo "\n" >>/tmp/u-$NOW.txt
echo "âœ… ðŸ§° mason.nvim updated"

echo "âœ… ðŸ§¾ logged to /tmp/u-$NOW.txt"
man /tmp/u-$NOW.txt

set FZF_GIT_DIR "$HOME/.config/fzf-git"
if test -d "$FZF_GIT_DIR"
    # Repository exists, so we run git pull
    gum spin --spinner globe --title "ðŸ“¦  Updating git fzf" --show-output -- git -C "$FZF_GIT_DIR" pull >> /tmp/u-$NOW.txt
    echo "\n" >> /tmp/u-$NOW.txt
    echo "âœ… ðŸ“¦  git fzf updated"
else
    # Repository does not exist, so we run git clone
    gum spin --spinner globe --title "ðŸš€  Cloning git fzf" --show-output -- git clone https://github.com/junegunn/fzf-git.sh.git "$FZF_GIT_DIR" >> /tmp/u-$NOW.txt
    echo "\n" >> /tmp/u-$NOW.txt
    echo "âœ… ðŸš€  git fzf cloned"
end
